<?xml version="1.0" encoding="utf-8"?>
<config>
	<remove xpath="/utility_ai/ai_packages"/>
	<!-- Remove TFP broken UAI xml  -->
	<append xpath="/utility_ai">
		<!-- The complete documentation for these actions and considerations are included in the UtilityAI.xml file found in the 0_SphereiiCore mod or prefixed to this file in the ConfigsDump UtilityAI.xml file -->
		<!-- UAI packages are delared in entityclasses.xml using, for example <property name="AIPackages" value="Human Basic, Human Melee Basic, Human Heal Basic"/>   If you have this property, it will override any EAI tasks and target properties on that entity. -->
		<!-- Note:  Place considerations that are most likely to fail before ones likely to be true, speeds up the AI calculations  -->
		<!-- Note:  Animal NPCs can use human UAI packages, but not extensively tested and probably should have their own packages  -->
		<!-- Dont use multiple versions of the same type of packages, like dont add the Human basic and the Human Timid basic on one character  -->
		
		<!-- Target filters (IsEnemy, IsSelf, IsPlayer, IsLeader, IsAlly )can be used on packages or on tasks.  These provide reduced context for considerations, improving efficency  -->
		
		<!-- NPCBasic is the default movement package for NPCs.  If all else fails, character should wander, otherwise follow or flee if wounded  -->
		
		<!-- flip_y inverts the output of a calculation, flip_x inverts the input.   -->
		<!-- <ai_packages max_entities="30" action_delay="0.2" > -->
		<ai_packages max_entities="30" action_delay="0.2" >
			<ai_package name="NPCBasic" >
				<action name="Wander" weight="1" entity_filter="IsSelf"><!-- Lowest weight, so wander doesnt win against any other action, yet will score true so the NPC does something if not busy in dialog. -->
					<task class="WanderSDX, SCore"/>
					<task class="IdleSDX, SCore" OnStartAddBuffs="RandomWanderIdle" OnStopRemoveBuffs="RandomWanderIdle" timeout="50" /><!-- fires an Idle buff on start, removes same on exit  -->
					<consideration class="HasOrder, SCore" order="None, Wander"/> <!-- blocks the action when it has an order not listed  -->
	 				<consideration class="IsNotBusy, SCore"/>   <!-- If doing an activity, don't just walkaway, do that animation -->
				</action>
				<action name="OnReload" weight="3" entity_filter="IsSelf" >
                    <task class="IdleSDX, SCore"  /> 
                    <consideration class="SelfHasBuff, SCore" buffs="buffReload2,buffReloadDelay,buffReload3"/> <!-- Outscores Wander when buff is active  -->
                </action>  
				<action name="Chat" weight="2" entity_filter="IsPlayer">
                    <task class="IdleSDX, SCore" OnStartAddBuffs="RandomIdle" OnStopRemoveBuffs="RandomIdle" /> 
                        <consideration class="EnemyNotNear, SCore" distance="20" /><!-- Default distance is 20, True if no enemies are near, so safe to chat  -->
                        <consideration class="TargetDistance" flip_x="true" min="1" max="4.5" curve="threshold" /><!-- Forces a fixed true range between 1 and 4 blocks -->
				</action> 
				<action name="ExitChat" weight="2" entity_filter="IsPlayer">
                    <task class="IdleSDX, SCore" OnStartRemoveBuffs="RandomIdle" /> 
                        <consideration class="EnemyNear, SCore" distance="20" /><!-- True if no enemies are near, so safe to chat  -->
                        <consideration class="TargetDistance" flip_x="true" min="1" max="4.5" curve="threshold" /><!-- Forces a fixed true range between 1 and 4 blocks -->
				</action> 				
                <action name="Stay" weight="2" entity_filter="IsSelf">
                    <task class="Guard, SCore"  /> 
                    <consideration class="EnemyNotNear, SCore" />
                    <consideration class="HasOrder, SCore" order="Stay"/>
                </action> 
				<action name="HealSelf" weight="6" entity_filter="IsSelf">
					<task class="HealSDX, SCore" OnStartAddBuffs="IsHealing" OnStopAddBuffs="buffProcessConsumables"/>
					<consideration class="SelfHealthSDX, SCore" min="0.01" max="0.60"/>
					<consideration class="EnemyNotNear, SCore" distance="5"/> 
					<consideration class="SelfNotHasBuff, SCore" buffs="IsHealing"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="buffHealHealth,buffProcessConsumables,buffReload2,buffReloadDelay,buffReload3,buffHitStun"/>
				</action>
				<action name="MendLegSelf" weight="5" entity_filter="IsSelf">
					<task class="HealSDX, SCore" run="true" OnStartAddBuffs="IsHealing" OnStopAddBuffs="buffLegSplinted"/>
					<consideration class="SelfHasBuff, SCore" buffs="buffLegBroken,buffLegSprained"/>
					<consideration class="EnemyNotNear, SCore" distance="5"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="IsHealing"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="buffHealHealth,buffProcessConsumables,buffReload2,buffReloadDelay,buffReload3,buffHitStun"/>
				</action>	
				<action name="MendArmSelf" weight="5" entity_filter="IsSelf">
					<task class="HealSDX, SCore" OnStartAddBuffs="IsHealing" OnStopAddBuffs="buffArmSplinted"/>
					<consideration class="SelfHasBuff, SCore" buffs="buffArmSprained,buffArmBroken"/>
					<consideration class="EnemyNotNear, SCore" distance="5"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="IsHealing"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="buffHealHealth,buffProcessConsumables,buffReload2,buffReloadDelay,buffReload3,buffHitStun"/>					
				</action>
				<action name="Flee" weight="6" entity_filter="IsEnemy">
					<task class="FleeFromTarget" max_distance="30"/>
					<consideration class="SelfHasCVar, SCore" cvar="Timid" value="1"/>
					<consideration class="TargetDistance" min="0" max="15" curve="threshold"/>
					<consideration class="SelfVisible"/>
				</action>				
			</ai_package>

			<ai_package name="NPCBasicNoChat" >
				<action name="Wander" weight="1" entity_filter="IsSelf"><!-- Lowest weight, so wander doesnt win against any other action, yet will score true so the NPC does something if not busy in dialog. -->
					<task class="WanderSDX, SCore"/>
					<task class="IdleSDX, SCore" OnStartAddBuffs="RandomWanderIdle" OnStopRemoveBuffs="RandomWanderIdle" timeout="50" /><!-- fires an Idle buff on start, removes same on exit  -->
					<consideration class="HasOrder, SCore" order="None, Wander"/> <!-- blocks the action when it has an order not listed  -->
	 				<consideration class="IsNotBusy, SCore"/>   <!-- If doing an activity, don't just walkaway, do that animation -->
				</action>
				<action name="OnReload" weight="3" entity_filter="IsSelf" >
                    <task class="IdleSDX, SCore"  /> 
                    <consideration class="SelfHasBuff, SCore" buffs="buffReload2,buffReloadDelay,buffReload3"/> <!-- Outscores Wander when buff is active  -->
                </action>  
				<action name="HealSelf" weight="6" entity_filter="IsSelf">
					<task class="HealSDX, SCore" OnStartAddBuffs="IsHealing" OnStopAddBuffs="buffProcessConsumables"/>
					<consideration class="SelfHealthSDX, SCore" min="0.01" max="0.60"/>
					<consideration class="EnemyNotNear, SCore" distance="5"/> 
					<consideration class="SelfNotHasBuff, SCore" buffs="IsHealing"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="buffHealHealth,buffProcessConsumables,buffReload2,buffReloadDelay,buffReload3,buffHitStun"/>
				</action>
				<action name="MendLegSelf" weight="5" entity_filter="IsSelf">
					<task class="HealSDX, SCore" run="true" OnStartAddBuffs="IsHealing" OnStopAddBuffs="buffLegSplinted"/>
					<consideration class="SelfHasBuff, SCore" buffs="buffLegBroken,buffLegSprained"/>
					<consideration class="EnemyNotNear, SCore" distance="5"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="IsHealing"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="buffHealHealth,buffProcessConsumables,buffReload2,buffReloadDelay,buffReload3,buffHitStun"/>
				</action>	
				<action name="MendArmSelf" weight="5" entity_filter="IsSelf">
					<task class="HealSDX, SCore" OnStartAddBuffs="IsHealing" OnStopAddBuffs="buffArmSplinted"/>
					<consideration class="SelfHasBuff, SCore" buffs="buffArmSprained,buffArmBroken"/>
					<consideration class="EnemyNotNear, SCore" distance="5"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="IsHealing"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="buffHealHealth,buffProcessConsumables,buffReload2,buffReloadDelay,buffReload3,buffHitStun"/>					
				</action>
				<action name="Flee" weight="6" entity_filter="IsEnemy">
					<task class="FleeFromTarget" max_distance="30"/>
					<consideration class="SelfHasCVar, SCore" cvar="Timid" value="1"/>
					<consideration class="TargetDistance" min="0" max="15" curve="threshold"/>
					<consideration class="SelfVisible"/>
				</action>				
			</ai_package>	
	
			<ai_package name="NPCHired" entity_filter="IsLeader" >
				<action name="TooClose" weight="3">
					<task class="BackupFromTargetSDX, SCore" max_distance="4.5"/>
					<consideration class="EnemyNotNear, SCore" />
					<consideration class="TargetDistance" flip_y="true" min="0" max="1"  />
					<consideration class="NotHasOrder, SCore" order="Stay"/>
				</action> 
				<action name="LeaderFollow" weight="2" >
					<task class="FollowSDX, SCore" OnStartAddBuffs="NPCpegasus" OnStopRemoveBuffs="NPCpegasus"/>
					<consideration class="HasOrder, SCore" order="Follow"/>
					<consideration class="TargetDistance"  min="10" max="50" curve="threshold" />
				</action>
				<action name="LeaderFollowSlow" weight="2" >
					<task class="FollowSDX, SCore"/>
					<consideration class="HasOrder, SCore" order="Follow"/>
					<consideration class="TargetDistance"  min="4.5" max="10" curve="threshold"/>
				</action>	
			</ai_package>
			
			<ai_package name="NPCMedic" entity_filter="IsAlly" > 
				<action name="HealOther" weight="5">
					<task class="HealSDX, SCore" run="true" OnStartAddBuffs="IsHealing" OnStopAddBuffsTarget="buffProcessConsumables"/>
					<consideration class="TargetHealthSDX, SCore" min="0.01" max="0.65"/>
					<consideration class="TargetDistance"  min="2" max="4" flip_x="true" curve="threshold"/>
					<consideration class="TargetNotHasBuff, SCore" buffs="buffHealHealth,buffProcessConsumables"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="IsHealing"/>
					<!-- <consideration class="EnemyNotNear, SCore" distance="10"/> Save the leader despite the risk to self, its your job!  -->
				</action>
				<action name="MendLegOther" weight="5">
					<task class="HealSDX, SCore" run="true" OnStartAddBuffs="IsHealing" OnStopAddBuffsTarget="buffLegSplinted"/>
					<consideration class="TargetHasBuff, SCore" buffs="buffLegBroken,buffLegSprained"/>
					<consideration class="TargetDistance"  min="2" max="4" flip_x="true" curve="threshold"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="IsHealing"/>
					<consideration class="TargetNotHasBuff, SCore" buffs="buffHealHealth,buffProcessConsumables"/>
				</action>			
				<action name="MendArmOther" weight="5">
					<task class="HealSDX, SCore" run="true" OnStartAddBuffs="IsHealing" OnStopAddBuffsTarget="buffArmSplinted"/>
					<consideration class="TargetHasBuff, SCore" buffs="buffArmSprained,buffArmBroken"/>
					<consideration class="TargetDistance"  min="2" max="4" flip_x="true" curve="threshold" />
					<consideration class="SelfNotHasBuff, SCore" buffs="IsHealing"/>
					<consideration class="TargetNotHasBuff, SCore" buffs="buffHealHealth,buffProcessConsumables"/>	
				</action>
				<!-- Action to move the NPC close to the ally who needs help -->
				<action name="MoveToHeal" weight="6">
					<task class="MoveToAttackTargetSDX, SCore" run="true" />
					<consideration class="TargetHealthSDX, SCore" min="0.01" max="0.65"/>
					<consideration class="TargetDistance" min="4" max="10" curve="threshold"/>
					<consideration class="TargetNotHasBuff, SCore" buffs="buffHealHealth,buffProcessConsumables"/>		
					<consideration class="SelfNotHasBuff, SCore" buffs="IsHealing"/>
					<consideration class="NotHasOrder, SCore" order="Stay"/>
				</action>
				<!-- Action to move the NPC close to the ally who needs help, specifically for sprained limbs. -->
				<!-- The above only moves them if their heal is low, whereas this is necessary for a broken limb, which may not trigger the health check -->
				<action name="MoveToMend" weight="6">
					<task class="MoveToAttackTargetSDX, SCore" run="true" />
					<consideration class="TargetHasBuff, SCore" buffs="buffArmSprained,buffArmBroken,buffLegBroken,buffLegSprained"/>
					<consideration class="TargetDistance" min="4" max="10" curve="threshold"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="IsHealing"/>
					<consideration class="NotHasOrder, SCore" order="Stay"/>
				</action>
			</ai_package>
			
			<ai_package name="NPCMeleeBasic" entity_filter="IsEnemy"> <!-- faction check  -->
				<action name="MoveToEnemyRunMelee" weight="4">
					<task class="MoveToAttackTargetSDX, SCore" run="true" /> 
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30"/>
					<consideration class="NotInWeaponRange, SCore" action_index="0" /> 
					<consideration class="CanSeeTarget, SCore"/>
					<consideration class="NotHasOrder, SCore" order="Stay"/>
					<consideration class="NotPathBlockedSDX, SCore"  />
				</action>
				 <action name="MoveToRandomTarget" weight="3" entity_filter="IsPlayer" >
                    <task class="MoveToInvestigate, SCore" run="true" />
                    <consideration class="FailOnDistanceToLeader, Score" max_distance="30"/>
                    <consideration class="NotInWeaponRange, SCore" action_index="0" /> 
                    <consideration class="CanNotSeeTarget, SCore"/>
					<consideration class="CanHearTarget, SCore" />
					<consideration class="NotPathBlockedSDX, SCore"  />
                     <consideration class="NotHasOrder, SCore" order="Stay"/>
                 </action>    					
				<action name="MeleeAttackEntity" weight="6">
					<task class="AttackTargetEntitySDX, SCore" action_index="0"/>
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30"/>
					<consideration class="InWeaponRange, SCore" action_index="0" /> 
					<consideration class="CanSeeTarget, SCore"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="IsHealing,buffHitStun"/>	
				</action>
				<action name="MeleeAttackBlock" weight="3">
                    <task class="AttackTargetEntitySDX, SCore" action_index="0"/>
                    <consideration class="PathBlockedSDX, SCore"  />
                    <consideration class="TargetType" type="Block"/>
                </action> 
				<!-- <action name="DoorBuster" weight="4">
                    <task class="BreakBlock, SCore" action_index="0"/>
                    <consideration class="PathBlockedSDX, SCore"  />
                    <consideration class="TargetType" type="BlockDoorSecure"/>
                </action> -->
				
			</ai_package>	
	
			<ai_package name="NPCRangedBasic" entity_filter="IsEnemy" > <!-- props to the team, especially Ramsey, for this upgraded code  -->
				 <action name="MoveToRandomTarget" weight="4" entity_filter="IsPlayer">
                    <task class="MoveToInvestigate, SCore" run="true" />
                    <consideration class="CanNotSeeTarget, SCore"/>
					<consideration class="CanHearTarget, SCore" />
					<consideration class="NotHasOrder, SCore" order="Stay" />
                </action>	
				<action name="MoveToEnemyShortRanged" weight="4">
					<task class="MoveToAttackTargetSDX, SCore" run="true" action_index="1" />
					<consideration class="TargetDistance" flip_x="true" min="15" curve="threshold" /> <!-- this means move to target if within 15 to max range  -->
					<consideration class="SelfHasBuff, SCore" buffs="PipeShotgunUser,PShotgunUser,AShotgunUser" />
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30" />
					<consideration class="CanSeeTarget, SCore" />
					<consideration class="NotHasOrder, SCore" order="Stay" />
				</action>
				<action name="MoveToEnemyMediumRanged" weight="4">
					<task class="MoveToAttackTargetSDX, SCore" run="true" action_index="1" />
					<consideration class="TargetDistance" flip_x="true" min="20" curve="threshold" />
					<consideration class="SelfNotHasBuff, SCore" buffs="PipeShotgunUser,PShotgunUser,AShotgunUser,SRifleUser,HRifleUser" />
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30" />
					<consideration class="CanSeeTarget, SCore" />
					<consideration class="NotHasOrder, SCore" order="Stay" />
				</action>
				<action name="MoveToEnemyLongRanged" weight="4">
					<task class="MoveToAttackTargetSDX, SCore" run="true" action_index="1" />
					<consideration class="TargetDistance" flip_x="true" min="25"  curve="threshold" />
					<consideration class="SelfHasBuff, SCore" buffs="SRifleUser,HRifleUser,RocketLUser" />
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30" />
					<consideration class="CanSeeTarget, SCore" />
					<consideration class="NotHasOrder, SCore" order="Stay" />
				</action>
				<action name="MeleeRangedAttack" weight="6">
					<task class="AttackTargetEntitySDX, SCore" action_index="0"/>
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30"/>
					<consideration class="InWeaponRange, SCore"  action_index="0"  /> 
					<consideration class="CanSeeTarget, SCore"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="IsHealing,buffHitStun"/>	
				</action>
				<action name="RangedAttack" weight="5">
					<task class="AttackTargetEntitySDX, SCore" action_index="1" />
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30" />
					<consideration class="CanSeeTarget, SCore" />
					<consideration class="InWeaponRange, SCore" action_index="1" />
					<consideration class="SelfNotHasBuff, SCore" buffs="buffBurstDelay,IsHealing,buffReload2,buffReloadDelay,buffReload3,RandomIdle,buffHitStun" />
				</action>
				<action name="BackupShortRanged" weight="3">
					<task class="BackupFromTargetSDX, SCore" run="true" max_distance="10"/> 
					<consideration class="SelfHasBuff, SCore" buffs="PipeShotgunUser,PShotgunUser,AShotgunUser" />
					<consideration class="TargetDistance" flip_x="true" max="15"  curve="threshold" /> 
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30"/>
					<consideration class="CanSeeTarget, SCore"/>
					<consideration class="NotHasOrder, SCore" order="Stay"/>
				</action>
				<action name="BackupMediumRanged" weight="3">
					<task class="BackupFromTargetSDX, SCore" run="true" max_distance="15"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="PipeShotgunUser,PShotgunUser,AShotgunUser,SRifleUser,HRifleUser" />
					<consideration class="TargetDistance" flip_x="true" max="20"  curve="threshold" />
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30"/>
					<consideration class="CanSeeTarget, SCore"/>
					<consideration class="NotHasOrder, SCore" order="Stay"/>
				</action>
				<action name="BackupLongRanged" weight="3">
					<task class="BackupFromTargetSDX, SCore" run="true" max_distance="20"/>
					<consideration class="SelfHasBuff, SCore" buffs="SRifleUser,HRifleUser,RocketLUser" />
					<consideration class="TargetDistance" flip_x="true" max="25"  curve="threshold" />
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30"/>
					<consideration class="CanSeeTarget, SCore"/>
					<consideration class="NotHasOrder, SCore" order="Stay"/>
				</action>
			</ai_package>	
			
			<ai_package name="NPCMelee" entity_filter="IsEnemy"> 
				<!-- DEFAULT ACTIONS -->
				<action name="MoveToEnemyRunMelee" weight="4">
					<task class="MoveToAttackTargetSDX, SCore" run="true" /> 
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30"/>
					<consideration class="NotInWeaponRange, SCore" action_index="0" /> 
					<consideration class="CanSeeTarget, SCore"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="buffNPCModThreatControlMode,buffNPCModFullControlMode,buffHitStun"/>	
					<consideration class="NotHasOrder, SCore" order="Stay"/>
				</action>
				<action name="MoveToRandomTarget" weight="3" entity_filter="IsPlayer">
                    <task class="MoveToInvestigate, SCore" run="true" />
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30"/>
					<consideration class="NotInWeaponRange, SCore" action_index="0" /> 
					<consideration class="CanNotSeeTarget, SCore"/>
					<consideration class="CanHearTarget, SCore" />
					<consideration class="SelfNotHasBuff, SCore" buffs="buffNPCModThreatControlMode,buffNPCModFullControlMode,buffHitStun"/>	
					<consideration class="NotHasOrder, SCore" order="Stay"/>
				</action>					
				<action name="MeleeAttackEntity" weight="5">
					<task class="AttackTargetEntitySDX, SCore" action_index="0"/>
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30"/>
					<consideration class="InWeaponRange, SCore" action_index="0" /> 
					<consideration class="CanSeeTarget, SCore"/> 
					<consideration class="SelfNotHasBuff, SCore" buffs="buffNPCModThreatControlMode,buffNPCModFullControlMode,IsHealing,buffHitStun"/>	
				</action>
				
				<!-- THREAT CONTROL ACTIONS - NO PLAYER COMMANDS -->
				<action name="LeaderFollowControl" weight="10" >
					<consideration class="SelfHasBuff, SCore" buffs="buffNPCModThreatControlMode,buffNPCModFullControlMode"/>
					<consideration class="SelfHasBuff, SCore" buffs="buffNPCModStopAttacking"/>
					<task class="FollowSDX, SCore" OnStartAddBuffs="NPCpegasus" OnStopRemoveBuffs="NPCpegasus"/>
					<consideration class="HasOrder, SCore" order="Follow"/>
				</action>
				<action name="MoveToEnemyRunMeleeThreatControl" weight="4">
					<consideration class="SelfHasBuff, SCore" buffs="buffNPCModThreatControlMode"/>
					<consideration class="TargetNotHasBuff, SCore" buffs="buffNPCModThreat"/>
					<task class="MoveToAttackTargetSDX, SCore" run="true" /> 
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30"/>
					<consideration class="NotInWeaponRange, SCore" action_index="0" /> 
					<consideration class="CanSeeTarget, SCore"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="buffNPCModStopAttacking,buffHitStun"/>	
					<consideration class="NotHasOrder, SCore" order="Stay"/>
				</action>
				 <action name="MoveToRandomTargetThreatControl" weight="3" entity_filter="IsPlayer" >
					<consideration class="SelfHasBuff, SCore" buffs="buffNPCModThreatControlMode"/>
					<consideration class="TargetNotHasBuff, SCore" buffs="buffNPCModThreat"/>
                    <task class="MoveToInvestigate, SCore" run="true" />
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30"/>
					<consideration class="NotInWeaponRange, SCore" action_index="0" /> 
					<consideration class="CanNotSeeTarget, SCore"/>
					<consideration class="CanHearTarget, SCore" />
					<consideration class="SelfNotHasBuff, SCore" buffs="buffNPCModStopAttacking,buffHitStun"/>	
					<consideration class="NotHasOrder, SCore" order="Stay"/>
                 </action>					
				<action name="MeleeAttackEntityThreatControl" weight="5">
					<consideration class="SelfHasBuff, SCore" buffs="buffNPCModThreatControlMode"/>
					<consideration class="TargetNotHasBuff, SCore" buffs="buffNPCModThreat"/>
					<task class="AttackTargetEntitySDX, SCore" action_index="0"/>
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30"/>
					<consideration class="InWeaponRange, SCore" action_index="0" /> 
					<consideration class="CanSeeTarget, SCore"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="buffNPCModStopAttacking,IsHealing,buffHitStun"/>	
				</action> 
				<!-- CONTROL ACTIONS - PLAYER IS BEING ATTACKED OR GAVE ATTACK COMMAND -->
				<action name="MoveToEnemyRunMeleeControlAttacked" weight="4">
					<consideration class="SelfHasBuff, SCore" buffs="buffNPCModThreatControlMode,buffNPCModFullControlMode"/>
					<consideration class="TargetHasBuff, SCore" buffs="buffNPCModAttacking"/>
					<task class="MoveToAttackTargetSDX, SCore" run="true" /> 
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30"/>
					<consideration class="NotInWeaponRange, SCore" action_index="0" /> 
					<consideration class="CanSeeTarget, SCore"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="buffNPCModStopAttacking,buffHitStun"/>	
					<consideration class="NotHasOrder, SCore" order="Stay"/>
				</action>
				 <action name="MoveToRandomTargetControlAttacked" weight="3" entity_filter="IsPlayer">
					<consideration class="SelfHasBuff, SCore" buffs="buffNPCModThreatControlMode,buffNPCModFullControlMode"/>
					<consideration class="TargetHasBuff, SCore" buffs="buffNPCModAttacking"/>
                    <task class="MoveToInvestigate, SCore" run="true" />
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30"/>
					<consideration class="NotInWeaponRange, SCore" action_index="0" /> 
					<consideration class="CanNotSeeTarget, SCore"/>
					<consideration class="CanHearTarget, SCore" />
					<consideration class="SelfNotHasBuff, SCore" buffs="buffNPCModStopAttacking,buffHitStun"/>	
					<consideration class="NotHasOrder, SCore" order="Stay"/>
                 </action>					
				<action name="MeleeAttackEntityControlAttacked" weight="5">
					<consideration class="SelfHasBuff, SCore" buffs="buffNPCModThreatControlMode,buffNPCModFullControlMode"/>
					<consideration class="TargetHasBuff, SCore" buffs="buffNPCModAttacking"/>
					<task class="AttackTargetEntitySDX, SCore" action_index="0"/>
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30"/>
					<consideration class="InWeaponRange, SCore" action_index="0" /> 
					<consideration class="CanSeeTarget, SCore"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="buffNPCModStopAttacking,IsHealing,buffHitStun"/>	
				</action> 
			</ai_package>	
			
			<ai_package name="NPCRanged" entity_filter="IsEnemy" > <!-- props to the team, especially Ramsey, for this upgraded code  -->
				<!-- DEFAULT ACTIONS -->
				 <action name="MoveToRandomTarget" weight="4" entity_filter="IsPlayer">
                    <task class="MoveToInvestigate, SCore" run="true" />
					<consideration class="SelfNotHasBuff, SCore" buffs="buffNPCModThreatControlMode,buffNPCModFullControlMode"/>
					<!--<consideration class="SelfHasCVar, SCore" cvar="varFactionBandit" value="1"/>-->
                    <consideration class="TargetDistance" max="30" curve="threshold"/>
                    <consideration class="CanNotSeeTarget, SCore"/>
					<consideration class="CanHearTarget, SCore" />
					<consideration class="NotHasOrder, SCore" order="Stay" />
                </action>	
				<action name="MoveToEnemyShortRanged" weight="4">
					<task class="MoveToAttackTargetSDX, SCore" run="true" action_index="1" />
					<consideration class="SelfNotHasBuff, SCore" buffs="buffNPCModThreatControlMode,buffNPCModFullControlMode"/>
					<consideration class="TargetDistance" min="15" max="20" curve="threshold" />
					<consideration class="SelfHasBuff, SCore" buffs="PipeShotgunUser,PShotgunUser,AShotgunUser" />
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30" />
					<consideration class="CanSeeTarget, SCore" />
					<consideration class="NotHasOrder, SCore" order="Stay" />
				</action>
				<action name="MoveToEnemyMediumRanged" weight="4">
					<task class="MoveToAttackTargetSDX, SCore" run="true" action_index="1" />
					<consideration class="SelfNotHasBuff, SCore" buffs="buffNPCModThreatControlMode,buffNPCModFullControlMode"/>
					<consideration class="TargetDistance" min="20" max="25" curve="threshold" />
					<consideration class="SelfNotHasBuff, SCore" buffs="PipeShotgunUser,PShotgunUser,AShotgunUser,SRifleUser,HRifleUser" />
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30" />
					<consideration class="CanSeeTarget, SCore" />
					<consideration class="NotHasOrder, SCore" order="Stay" />
				</action>
				<action name="MoveToEnemyLongRanged" weight="4">
					<task class="MoveToAttackTargetSDX, SCore" run="true" action_index="1" />
					<consideration class="SelfNotHasBuff, SCore" buffs="buffNPCModThreatControlMode,buffNPCModFullControlMode"/>
					<consideration class="TargetDistance" min="25" max="30" curve="threshold" />
					<consideration class="SelfHasBuff, SCore" buffs="SRifleUser,HRifleUser" />
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30" />
					<consideration class="CanSeeTarget, SCore" />
					<consideration class="NotHasOrder, SCore" order="Stay" />
				</action>
				<action name="MeleeRangedAttack" weight="6">
					<task class="AttackTargetEntitySDX, SCore" action_index="0"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="buffNPCModThreatControlMode,buffNPCModFullControlMode"/>
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30"/>
					<consideration class="InWeaponRange, SCore"  action_index="0"  /> 
					<consideration class="CanSeeTarget, SCore"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="IsHealing,buffHitStun"/>	
				</action>
				<action name="RangedAttack" weight="5">
					<task class="AttackTargetEntitySDX, SCore" action_index="1" />
					<consideration class="SelfNotHasBuff, SCore" buffs="buffNPCModThreatControlMode,buffNPCModFullControlMode"/>
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30" />
					<consideration class="CanSeeTarget, SCore" />
					<consideration class="InWeaponRange, SCore" action_index="1" />
					<consideration class="SelfNotHasBuff, SCore" buffs="buffBurstDelay,IsHealing,buffReload2,buffReloadDelay,buffReload3,RandomIdle,buffHitStun" />
				</action>
				<action name="BackupShortRanged" weight="3">
					<task class="BackupFromTargetSDX, SCore" run="true" max_distance="10"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="buffNPCModThreatControlMode,buffNPCModFullControlMode"/>
					<consideration class="SelfHasBuff, SCore" buffs="PipeShotgunUser,PShotgunUser,AShotgunUser" />
					<consideration class="InWeaponRange, SCore" action_index="1" />
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30"/>
					<consideration class="CanSeeTarget, SCore"/>
					<consideration class="NotHasOrder, SCore" order="Stay"/>
				</action>
				<action name="BackupMediumRanged" weight="3">
					<task class="BackupFromTargetSDX, SCore" run="true" max_distance="15"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="buffNPCModThreatControlMode,buffNPCModFullControlMode"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="PipeShotgunUser,PShotgunUser,AShotgunUser,SRifleUser,HRifleUser" />
					<consideration class="InWeaponRange, SCore" action_index="1" />
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30"/>
					<consideration class="CanSeeTarget, SCore"/>
					<consideration class="NotHasOrder, SCore" order="Stay"/>
				</action>
				<action name="BackupLongRanged" weight="3">
					<task class="BackupFromTargetSDX, SCore" run="true" max_distance="20"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="buffNPCModThreatControlMode,buffNPCModFullControlMode"/>
					<consideration class="SelfHasBuff, SCore" buffs="SRifleUser,HRifleUser" />
					<consideration class="InWeaponRange, SCore" action_index="1" />
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30"/>
					<consideration class="CanSeeTarget, SCore"/>
					<consideration class="NotHasOrder, SCore" order="Stay"/>
				</action>
				<!-- CONTROL ACTIONS - NO PLAYER COMMANDS -->
				<action name="LeaderFollowControl" weight="10" >
					<task class="FollowSDX, SCore" OnStartAddBuffs="NPCpegasus" OnStopRemoveBuffs="NPCpegasus"/>
					<consideration class="SelfHasBuff, SCore" buffs="buffNPCModThreatControlMode,buffNPCModFullControlMode"/>
					<consideration class="SelfHasBuff, SCore" buffs="buffNPCModStopAttacking"/>
					<consideration class="HasOrder, SCore" order="Follow"/>
				</action>
				 <action name="MoveToRandomTargetThreatControl" weight="4" entity_filter="IsPlayer">
                    <task class="MoveToInvestigate, SCore" run="true" />
					<consideration class="SelfHasBuff, SCore" buffs="buffNPCModThreatControlMode"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="buffNPCModStopAttacking"/>
					<consideration class="TargetNotHasBuff, SCore" buffs="buffNPCModThreat"/>
                    <consideration class="TargetDistance" max="30" curve="threshold"/>
                    <consideration class="CanNotSeeTarget, SCore"/>
					<consideration class="CanHearTarget, SCore" />
					<consideration class="NotHasOrder, SCore" order="Stay" />
                </action>	
				<action name="MoveToEnemyShortRangedThreatControl" weight="4">
					<task class="MoveToAttackTargetSDX, SCore" run="true" action_index="1" />
					<consideration class="SelfHasBuff, SCore" buffs="buffNPCModThreatControlMode"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="buffNPCModStopAttacking"/>
					<consideration class="TargetNotHasBuff, SCore" buffs="buffNPCModThreat"/>
					<consideration class="TargetDistance" min="15" max="20" curve="threshold" />
					<consideration class="SelfHasBuff, SCore" buffs="PipeShotgunUser,PShotgunUser,AShotgunUser" />
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30" />
					<consideration class="CanSeeTarget, SCore" />
					<consideration class="NotHasOrder, SCore" order="Stay" />
				</action>
				<action name="MoveToEnemyMediumRangedThreatControl" weight="4">
					<task class="MoveToAttackTargetSDX, SCore" run="true" action_index="1" />
					<consideration class="SelfHasBuff, SCore" buffs="buffNPCModThreatControlMode"/>
					<consideration class="TargetNotHasBuff, SCore" buffs="buffNPCModThreat"/>
					<consideration class="TargetDistance" min="20" max="25" curve="threshold" />
					<consideration class="SelfNotHasBuff, SCore" buffs="buffNPCModStopAttacking,PipeShotgunUser,PShotgunUser,AShotgunUser,SRifleUser,HRifleUser" />
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30" />
					<consideration class="CanSeeTarget, SCore" />
					<consideration class="NotHasOrder, SCore" order="Stay" />
				</action>
				<action name="MoveToEnemyLongRangedThreatControl" weight="4">
					<task class="MoveToAttackTargetSDX, SCore" run="true" action_index="1" />
					<consideration class="SelfHasBuff, SCore" buffs="buffNPCModThreatControlMode"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="buffNPCModStopAttacking"/>
					<consideration class="TargetNotHasBuff, SCore" buffs="buffNPCModThreat"/>
					<consideration class="TargetDistance" min="25" max="30" curve="threshold" />
					<consideration class="SelfHasBuff, SCore" buffs="SRifleUser,HRifleUser" />
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30" />
					<consideration class="CanSeeTarget, SCore" />
					<consideration class="NotHasOrder, SCore" order="Stay" />
				</action>
				<action name="MeleeRangedAttackThreatControl" weight="6">
					<task class="AttackTargetEntitySDX, SCore" action_index="0"/>
					<consideration class="SelfHasBuff, SCore" buffs="buffNPCModThreatControlMode"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="buffNPCModStopAttacking"/>
					<consideration class="TargetNotHasBuff, SCore" buffs="buffNPCModThreat"/>
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30"/>
					<consideration class="TargetHasBuff, SCore" buffs="buffNPCModAttacking"/>
					<consideration class="InWeaponRange, SCore"  action_index="0"  /> 
					<consideration class="CanSeeTarget, SCore"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="IsHealing,buffHitStun"/>	
				</action>
				<action name="RangedAttackThreatControl" weight="5">
					<task class="AttackTargetEntitySDX, SCore" action_index="1" />
					<consideration class="SelfHasBuff, SCore" buffs="buffNPCModThreatControlMode"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="buffNPCModStopAttacking"/>
					<consideration class="TargetNotHasBuff, SCore" buffs="buffNPCModThreat"/>
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30" />
					<consideration class="CanSeeTarget, SCore" />
					<consideration class="InWeaponRange, SCore" action_index="1" />
					<consideration class="SelfNotHasBuff, SCore" buffs="buffBurstDelay,IsHealing,buffReload2,buffReloadDelay,buffReload3,RandomIdle,buffHitStun" />
				</action>
				<action name="BackupShortRangedThreatControl" weight="3">
					<task class="BackupFromTargetSDX, SCore" run="true" max_distance="10"/>
					<consideration class="SelfHasBuff, SCore" buffs="buffNPCModThreatControlMode"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="buffNPCModStopAttacking"/>
					<consideration class="TargetNotHasBuff, SCore" buffs="buffNPCModThreat"/>
					<consideration class="SelfHasBuff, SCore" buffs="PipeShotgunUser,PShotgunUser,AShotgunUser" />
					<consideration class="InWeaponRange, SCore" action_index="1" />
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30"/>
					<consideration class="CanSeeTarget, SCore"/>
					<consideration class="NotHasOrder, SCore" order="Stay"/>
				</action>
				<action name="BackupMediumRangedThreatControl" weight="3">
					<task class="BackupFromTargetSDX, SCore" run="true" max_distance="15"/>
					<consideration class="SelfHasBuff, SCore" buffs="buffNPCModThreatControlMode"/>
					<consideration class="TargetNotHasBuff, SCore" buffs="buffNPCModThreat"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="buffNPCModStopAttacking,PipeShotgunUser,PShotgunUser,AShotgunUser,SRifleUser,HRifleUser" />
					<consideration class="InWeaponRange, SCore" action_index="1" />
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30"/>
					<consideration class="CanSeeTarget, SCore"/>
					<consideration class="NotHasOrder, SCore" order="Stay"/>
				</action>
				<action name="BackupLongRangedThreatControl" weight="3">
					<task class="BackupFromTargetSDX, SCore" run="true" max_distance="20"/>
					<consideration class="SelfHasBuff, SCore" buffs="buffNPCModThreatControlMode"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="buffNPCModStopAttacking"/>
					<consideration class="TargetNotHasBuff, SCore" buffs="buffNPCModThreat"/>
					<consideration class="SelfHasBuff, SCore" buffs="SRifleUser,HRifleUser" />
					<consideration class="InWeaponRange, SCore" action_index="1" />
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30"/>
					<consideration class="CanSeeTarget, SCore"/>
					<consideration class="NotHasOrder, SCore" order="Stay"/>
				</action>
				<!-- CONTROL ACTIONS - PLAYER IS BEING ATTACKED OR GAVE ATTACK COMMAND -->
				 <action name="MoveToRandomTargetControlAttacked" weight="4" entity_filter="IsPlayer">
                    <task class="MoveToInvestigate, SCore" run="true" />
					<consideration class="SelfHasBuff, SCore" buffs="buffNPCModThreatControlMode,buffNPCModFullControlMode"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="buffNPCModStopAttacking"/>
					<consideration class="TargetHasBuff, SCore" buffs="buffNPCModAttacking"/>
                    <consideration class="TargetDistance" max="30" curve="threshold"/>
                    <consideration class="CanNotSeeTarget, SCore"/>
					<consideration class="CanHearTarget, SCore" />
					<consideration class="NotHasOrder, SCore" order="Stay" />
                </action>	
				<action name="MoveToEnemyShortRangedControlAttacked" weight="4">
					<task class="MoveToAttackTargetSDX, SCore" run="true" action_index="1" />
					<consideration class="SelfHasBuff, SCore" buffs="buffNPCModThreatControlMode,buffNPCModFullControlMode"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="buffNPCModStopAttacking"/>
					<consideration class="TargetHasBuff, SCore" buffs="buffNPCModAttacking"/>
					<consideration class="TargetDistance" min="15" max="20" curve="threshold" />
					<consideration class="SelfHasBuff, SCore" buffs="PipeShotgunUser,PShotgunUser,AShotgunUser" />
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30" />
					<consideration class="CanSeeTarget, SCore" />
					<consideration class="NotHasOrder, SCore" order="Stay" />
				</action>
				<action name="MoveToEnemyMediumRangedControlAttacked" weight="4">
					<task class="MoveToAttackTargetSDX, SCore" run="true" action_index="1" />
					<consideration class="SelfHasBuff, SCore" buffs="buffNPCModThreatControlMode,buffNPCModFullControlMode"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="buffNPCModStopAttacking"/>
					<consideration class="TargetHasBuff, SCore" buffs="buffNPCModAttacking"/>
					<consideration class="TargetDistance" min="20" max="25" curve="threshold" />
					<consideration class="SelfNotHasBuff, SCore" buffs="PipeShotgunUser,PShotgunUser,AShotgunUser,SRifleUser,HRifleUser" />
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30" />
					<consideration class="CanSeeTarget, SCore" />
					<consideration class="NotHasOrder, SCore" order="Stay" />
				</action>
				<action name="MoveToEnemyLongRangedControlAttacked" weight="4">
					<task class="MoveToAttackTargetSDX, SCore" run="true" action_index="1" />
					<consideration class="SelfHasBuff, SCore" buffs="buffNPCModThreatControlMode,buffNPCModFullControlMode"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="buffNPCModStopAttacking"/>
					<consideration class="TargetHasBuff, SCore" buffs="buffNPCModAttacking"/>
					<consideration class="TargetDistance" min="25" max="30" curve="threshold" />
					<consideration class="SelfHasBuff, SCore" buffs="SRifleUser,HRifleUser" />
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30" />
					<consideration class="CanSeeTarget, SCore" />
					<consideration class="NotHasOrder, SCore" order="Stay" />
				</action>
				<action name="MeleeRangedAttackControlAttacked" weight="6">
					<task class="AttackTargetEntitySDX, SCore" action_index="0"/>
					<consideration class="SelfHasBuff, SCore" buffs="buffNPCModThreatControlMode,buffNPCModFullControlMode"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="buffNPCModStopAttacking"/>
					<consideration class="TargetHasBuff, SCore" buffs="buffNPCModAttacking"/>
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30"/>
					<consideration class="InWeaponRange, SCore"  action_index="0"  /> 
					<consideration class="CanSeeTarget, SCore"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="IsHealing,buffHitStun"/>	
				</action>
				<action name="RangedAttackControlAttacked" weight="5">
					<task class="AttackTargetEntitySDX, SCore" action_index="1" />
					<consideration class="SelfHasBuff, SCore" buffs="buffNPCModThreatControlMode,buffNPCModFullControlMode"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="buffNPCModStopAttacking"/>
					<consideration class="TargetHasBuff, SCore" buffs="buffNPCModAttacking"/>
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30" />
					<consideration class="CanSeeTarget, SCore" />
					<consideration class="InWeaponRange, SCore" action_index="1" />
					<consideration class="SelfNotHasBuff, SCore" buffs="buffBurstDelay,IsHealing,buffReload2,buffReloadDelay,buffReload3,RandomIdle,buffHitStun" />
				</action>
				<action name="BackupShortRangedControlAttacked" weight="3">
					<task class="BackupFromTargetSDX, SCore" run="true" max_distance="10"/>
					<consideration class="SelfHasBuff, SCore" buffs="buffNPCModThreatControlMode,buffNPCModFullControlMode"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="buffNPCModStopAttacking"/>
					<consideration class="TargetHasBuff, SCore" buffs="buffNPCModAttacking"/>
					<consideration class="SelfHasBuff, SCore" buffs="PipeShotgunUser,PShotgunUser,AShotgunUser" />
					<consideration class="InWeaponRange, SCore" action_index="1" />
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30"/>
					<consideration class="CanSeeTarget, SCore"/>
					<consideration class="NotHasOrder, SCore" order="Stay"/>
				</action>
				<action name="BackupMediumRangedControlAttacked" weight="3">
					<task class="BackupFromTargetSDX, SCore" run="true" max_distance="15"/>
					<consideration class="SelfHasBuff, SCore" buffs="buffNPCModThreatControlMode,buffNPCModFullControlMode"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="buffNPCModStopAttacking"/>
					<consideration class="TargetHasBuff, SCore" buffs="buffNPCModAttacking"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="PipeShotgunUser,PShotgunUser,AShotgunUser,SRifleUser,HRifleUser" />
					<consideration class="InWeaponRange, SCore" action_index="1" />
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30"/>
					<consideration class="CanSeeTarget, SCore"/>
					<consideration class="NotHasOrder, SCore" order="Stay"/>
				</action>
				<action name="BackupLongRangedControlAttacked" weight="3">
					<task class="BackupFromTargetSDX, SCore" run="true" max_distance="20"/>
					<consideration class="SelfHasBuff, SCore" buffs="buffNPCModThreatControlMode,buffNPCModFullControlMode"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="buffNPCModStopAttacking"/>
					<consideration class="TargetHasBuff, SCore" buffs="buffNPCModAttacking"/>
					<consideration class="SelfHasBuff, SCore" buffs="SRifleUser,HRifleUser" />
					<consideration class="InWeaponRange, SCore" action_index="1" />
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30"/>
					<consideration class="CanSeeTarget, SCore"/>
					<consideration class="NotHasOrder, SCore" order="Stay"/>
				</action>
			</ai_package>	
			
			<!-- Activities are misc. activities NPCs can do, WIP,  list will expand in time -->
			<ai_package name="NPCLoot">
                <action name="LootBasic" weight="2" entity_filter="IsSelf" >
                    <task class="Loot, SCore" run="false" TargetType="Loot, SecureLoot" buff="ActivityBuff"/>
                    <consideration class="HasOrder, SCore" order="Loot"/>
                   <consideration class="EnemyNotNear, SCore" distance="15"/> 
				   <consideration class="FailOnDistanceToLeader, Score" max_distance="30"/>
				   <consideration class="SelfNotHasBuff, SCore" buffs="ActivityCoolDown"/>
                </action>
            </ai_package>
			
			<ai_package name="NPCCraft"> <!--  Not hooked up yet  -->
				<action name="Craft Basic" weight="2">
					<task class="MoveToExplore, SCore" run="false" buff="ActivityBuff"/>
					<!-- NPC will wander a chunk area and look for a PathTarget type specified.  If true, move to target and when reached, run the specified ActivityBuff so correct animation plays  -->
					<consideration class="EnemyNotNear, SCore"/>
					<!--Is there an enemy nearby? Loot only when safe, (EnemyNear is the alternative)  -->
					<consideration class="SelfNotHasBuff, SCore" buffs="ActivityCoolDown"/>
					<!-- Don't fire this if the activity cool down buff is set to prevent tasklock.  Could use a different buff to turn off all looting here
					too -->
					<consideration class="HasPath, SCore"/>
					<!-- Checks if the NPC has any Tile Entities in its area of scan. If there's none, it'll scan for some -->
					<consideration class="PathTarget, SCore" type="Campfire, Forge, Workstation"/>
					<!-- filter the task even more by tile entity type. -->
				</action>
			</ai_package>

			<!-- Zombie Base UAI package : Not recommended, use EAI instead.  There are unresolved issues -->
	
			<ai_package name="Zombie Dumb">
				<!--   -->
				<action name="Wander" weight="1">
					<task class="WanderSDX, SCore"/>
					<consideration class="IsNotBusy, SCore"/>
					<consideration class="Random, SCore" percent="0.90"/>
				</action>
				<action name="MoveToWaypoint" weight="2">
					<task class="MoveToTarget" run="false"/>
					<consideration class="TargetType" type="Block"/>
					<consideration class="TargetDistance" min="2" max="4" curve="threshold"/>
					<consideration class="TargetVisible" flip_y="true"/>
				</action>
				<action name="MoveToEnemyAgro" weight="5">
					<task class="MoveToAttackTargetSDX, SCore" run="true"/>
					<consideration class="TargetType" type="EntityPlayer,EntityNPC"/>
					<consideration class="TargetIsEnemy, SCore"/>
					<consideration class="TargetDistance" min="2" max="30" curve="threshold"/>
				</action>
				<action name="MeleeAttackEntity" weight="5">
					<task class="AttackTargetEntity" action_index="0"/>
					<consideration class="TargetType" type="EntityPlayer,EntityNPC"/>
					<consideration class="TargetIsEnemy, SCore"/>
					<consideration class="TargetDistance" min="0" max="2" curve="threshold" />
				</action>
				<action name="MeleeAttackBlock" weight="3">
					<task class="AttackTargetBlock" action_index="0"/>
					<consideration class="PathBlocked"/>
					<consideration class="TargetType" type="Block"/>
					<consideration class="TargetDistance" min="0" max="2" curve="threshold"/>
				</action>
			</ai_package>
			
			<!-- Animal Base UAI package : Not recommended, use EAI instead.  There are unresolved issues -->
			
			<ai_package name="Animal Aggressive Basic">
				<action name="Wander" weight="1">
					<task class="WanderSDX, SCore"/>
					<consideration class="HasOrder, SCore" order="None, Wander"/> 
				</action>
				<action name="MoveToWaypoint" weight="2">
					<task class="MoveToTarget" run="false"/>
					<consideration class="TargetType" type="Block"/>
					<consideration class="TargetDistance" flip_x="true" min="2" max="4" curve="threshold"/>
					<consideration class="TargetVisible" flip_y="true"/>
				</action>
				<action name="MoveToEnemyAgro" weight="3">
					<task class="MoveToAttackTargetSDX, SCore" run="true"/>
					<consideration class="TargetType" type="EntityPlayer,EntityNPC"/>
					<consideration class="TargetIsEnemy, SCore"/>
					<consideration class="TargetDistance" min="2" max="30" curve="threshold"/>
				</action>
				<action name="MeleeAttackEntity" weight="5">
					<task class="AttackTargetEntity" action_index="0"/>
					<consideration class="TargetType" type="EntityPlayer,EntityNPC"/>
					<consideration class="TargetIsEnemy, SCore"/>
					<consideration class="TargetDistance" flip_x="true" min="0" max="2" curve="threshold"/>
				</action>
				<action name="MeleeAttackBlock" weight="5">
					<task class="AttackTargetBlock" action_index="0"/>
					<consideration class="PathBlocked"/>
					<consideration class="TargetType" type="Block"/>
					<consideration class="TargetDistance" flip_x="true" min="0" max="2" curve="threshold"/>
				</action>
			</ai_package>
			
			<ai_package name="NPCAnimalBasic" >
				<action name="Wander" weight="1" entity_filter="IsSelf">
					<task class="WanderSDX, SCore"/>
					<!--<task class="IdleSDX, SCore" OnStartAddBuffs="RandomWanderIdle" OnStopRemoveBuffs="RandomWanderIdle" timeout="50" /> -->
					<consideration class="HasOrder, SCore" order="None, Wander"/> 
				</action>
				<action name="Chat" weight="2" entity_filter="IsPlayer">
                    <task class="IdleSDX, SCore"  /> 
                        <consideration class="EnemyNotNear, SCore"/><!-- True if no enemies are near, so safe to chat  -->
						<consideration class="TargetDistance" flip_x="true" min="1" max="4.5" curve="threshold" /><!-- Forces a fixed true range between 1 and 3 blocks -->
                 </action> 
				<action name="Stay" weight="2" >
					<task class="IdleSDX, SCore"  /> 
					<consideration class="EnemyNotNear, SCore"/>
					<consideration class="HasOrder, SCore" order="Stay"/>
				</action>  
				<action name="Flee" weight="6">
					<task class="FleeFromTarget" max_distance="30"/>
					<consideration class="SelfHasCVar, SCore" cvar="Timid" value="1"/>
					<consideration class="TargetDistance" min="0" max="15" curve="threshold"/>
					<consideration class="SelfVisible"/>
				</action>				
			</ai_package>
			
			<ai_package name="NPCAnimalCompanion" >
                <action name="Wander" weight="1" entity_filter="IsSelf"><!-- Lowest weight, so wander doesnt win against any other action, yet will score true so the NPC does something if not busy in dialog. -->
                    <task class="WanderSDX, SCore"/>
                    <task class="IdleSDX, SCore" OnStartAddBuffs="RandomWanderIdle" OnStopRemoveBuffs="RandomWanderIdle" timeout="50" /><!-- fires an Idle buff on start, removes same on exit  -->
                    <consideration class="HasOrder, SCore" order="None, Wander"/> <!-- blocks the action when it has an order not listed  -->
                </action>
                <action name="Chat" weight="2" entity_filter="IsPlayer">
                    <task class="IdleSDX, SCore" OnStartAddBuffs="RandomIdle" OnStopRemoveBuffs="RandomIdle" /> 
                        <consideration class="EnemyNotNear, SCore" distance="20" /><!-- Default distance is 20, True if no enemies are near, so safe to chat  -->
                        <consideration class="TargetDistance" flip_x="true" min="1" max="4.5" curve="threshold" />
                </action> 
                <action name="Stay" weight="2" entity_filter="IsSelf">
                    <task class="Guard, SCore"  /> 
                    <consideration class="EnemyNotNear, SCore" />
                    <consideration class="HasOrder, SCore" order="Stay"/>
                </action> 
            </ai_package>
			
			<ai_package name="NPCHiredCompanion" entity_filter="IsLeader" >
                <action name="TooClose" weight="3">
                    <task class="BackupFromTargetSDX, SCore" max_distance="2"/>
                    <consideration class="EnemyNotNear, SCore" />
                    <consideration class="TargetDistance" flip_y="true" min="0" max="1"  />
                    <consideration class="NotHasOrder, SCore" order="Stay"/>
                </action> 
                <action name="LeaderFollow" weight="2" >
                    <task class="FollowSDX, SCore" OnStartAddBuffs="NPCpegasus" OnStopRemoveBuffs="NPCpegasus"/>
                    <consideration class="HasOrder, SCore" order="Follow"/>
                    <consideration class="EnemyNotNear, SCore"/>
                    <consideration class="TargetDistance"  min="7" max="50" curve="threshold" />
                </action>
                <action name="LeaderFollowSlow" weight="2" >
                    <task class="FollowSDX, SCore"/>
                    <consideration class="HasOrder, SCore" order="Follow"/>
                    <consideration class="EnemyNotNear, SCore"/>
                    <consideration class="TargetDistance"  min="2" max="6" curve="threshold"/>
                </action>
            </ai_package>
			<ai_package name="NPCMeleeCompanion" entity_filter="IsEnemy"> 
                <!-- CONTROL ACTIONS - PLAYER IS BEING ATTACKED OR IS ATTACKING A TARGET -->
                <action name="MoveToEnemyRunMeleeControlAttacked" weight="4">
                    <consideration class="TargetHasBuff, SCore" buffs="buffNPCModAttacking"/>
                    <task class="MoveToAttackTargetSDX, SCore" run="true" /> 
                    <consideration class="FailOnDistanceToLeader, Score" max_distance="30"/>
                    <consideration class="NotInWeaponRange, SCore" action_index="0" /> 
                    <consideration class="CanSeeTarget, SCore"/>
                    <consideration class="SelfNotHasBuff, SCore" buffs="buffNPCModStopAttacking,buffHitStun"/>    
                    <consideration class="NotHasOrder, SCore" order="Stay"/>
                </action>
                <action name="MeleeAttackEntityControlAttacked" weight="5">
                    <consideration class="TargetHasBuff, SCore" buffs="buffNPCModAttacking"/>
                    <task class="AttackTargetEntitySDX, SCore" action_index="0"/>
                    <consideration class="FailOnDistanceToLeader, Score" max_distance="30"/>
                    <consideration class="InWeaponRange, SCore" action_index="0" /> 
                    <consideration class="CanSeeTarget, SCore"/>
                    <consideration class="SelfNotHasBuff, SCore" buffs="buffNPCModStopAttacking,IsHealing,buffHitStun"/>    
                </action>
            </ai_package>    

			
			<!--  Mech Packages  -->
			
			<ai_package name="NPCMechBasic" >
				<action name="Wander" weight="1" entity_filter="IsSelf">
					<task class="WanderSDX, SCore"/>
				</action>
				<action name="Chat" weight="2" entity_filter="IsPlayer">
                    <task class="IdleSDX, SCore" OnStartAddBuffs="RandomIdle" OnStopRemoveBuffs="RandomIdle" /> 
                        <consideration class="EnemyNotNear, SCore" distance="20" />
                        <consideration class="TargetDistance" flip_x="true" min="1" max="4.5" curve="threshold" />
				</action> 
                <action name="Stay" weight="2" entity_filter="IsSelf">
                    <task class="Guard, SCore"  /> 
                    <consideration class="EnemyNotNear, SCore" />
                    <consideration class="HasOrder, SCore" order="Stay"/>
                </action> 
				<action name="HealSelf" weight="6" entity_filter="IsSelf">
					<task class="HealSDX, SCore" OnStartAddBuffs="IsHealing" OnStopAddBuffs="buffProcessConsumables"/>
					<consideration class="SelfHealthSDX, SCore" min="0.01" max="0.60"/>
					<consideration class="EnemyNotNear, SCore" distance="5"/> 
					<consideration class="SelfNotHasBuff, SCore" buffs="IsHealing"/>
					<consideration class="SelfNotHasBuff, SCore" buffs="buffHealHealth,buffProcessConsumables,buffReload2,buffReloadDelay,buffReload3,buffHitStun"/>
				</action>
			</ai_package>

			<ai_package name="NPCMechRangedBasic" entity_filter="IsEnemy" > 
				 <action name="MoveToRandomTarget" weight="4" entity_filter="IsPlayer">
                    <task class="MoveToInvestigate, SCore" run="true" />
                    <consideration class="CanNotSeeTarget, SCore"/>
					<consideration class="CanHearTarget, SCore" />
					<consideration class="NotHasOrder, SCore" order="Stay" />
                </action>	
				<action name="MoveToEnemy" weight="4">
					<task class="MoveToAttackTargetSDX, SCore" run="true" action_index="1" />
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30" />
					<consideration class="TargetVisible" />
					<consideration class="NotHasOrder, SCore" order="Stay" />
				</action>
				<action name="MeleeRangedAttack" weight="6">
					<task class="AttackTargetEntitySDX, SCore" action_index="0"/>
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30"/>
					<consideration class="InWeaponRange, SCore"  action_index="0"  /> 
					<consideration class="TargetVisible" />
					<consideration class="SelfNotHasBuff, SCore" buffs="IsHealing"/>	
				</action>
				<action name="RangedAttack" weight="5">
					<task class="AttackTargetEntitySDX, SCore" action_index="1" />
					<consideration class="FailOnDistanceToLeader, Score" max_distance="30" />
					<consideration class="TargetVisible" />
					<consideration class="InWeaponRange, SCore" action_index="1" />
					<consideration class="SelfNotHasBuff, SCore" buffs="buffBurstDelay,IsHealing" /> 
				</action>
			</ai_package>	
			
		</ai_packages>
	</append>
</config>
